<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tesla - Model S</title>
    <link rel="stylesheet" href="style.css" />

    <!-- Load Iterable Web SDK -->
    <script defer src="https://unpkg.com/@iterable/web-sdk/index.js"></script>
  </head>
  <body class="models">
    <div class="header" id="header">
      <nav>
        <img src="images/logo.png" class="logo" />
        <ul>
          <li><a href="index.html">Model S</a></li>
          <li><a href="model3.html">Model 3</a></li>
          <li><a href="modelx.html">Model X</a></li>
          <li><a href="modely.html">Model Y</a></li>
        </ul>
        <a href="#" class="btn">Reserve Now</a>
      </nav>

      <div class="info">
        <div>
          <h2>1.9 s</h2>
          <p>60 mph</p>
        </div>
        <div>
          <h2>200 mph</h2>
          <p>Top Speed</p>
        </div>
        <div>
          <h2>390 mi</h2>
          <p>Max Range</p>
        </div>
        <div class="line"></div>
        <div>
          <h2 id="model">Model S</h2>
        </div>
      </div>
    </div>

    <!-- JavaScript to initialize Iterable -->
    <script>
      window.addEventListener("load", function () {
        console.log("✅ Page loaded");

        // Wait for SDK to be available
        var interval = setInterval(function () {
          if (window.Iterable && typeof Iterable.initialize === "function") {
            clearInterval(interval);
            console.log("✅ Iterable SDK Loaded Successfully");

            // Securely fetch API key (replace with actual API key)
            const API_KEY = "8c641f7927bc4c8da562f28d04563bc5";

            // Initialize Iterable WITHOUT JWT
            Iterable.initialize(API_KEY, {
              autoPushSubscribe: true, // Enable push notifications
              verbose: true, // Enable logging
            });

            // Identify user
            Iterable.setUserId("Taylan.Somani@gmail.com");
            console.log("✅ User Identified:", Iterable.getUserId());

            // Track "Reserve Now" button click
            function trackReserveNow() {
              Iterable.track("Reserve Now Clicked", {
                model: "Model S",
                page: window.location.pathname,
              }).then(() => {
                console.log("✅ Event tracked successfully");
              }).catch(error => {
                console.error("❌ Error tracking event:", error);
              });
            }

            // Attach event listener
            const btn = document.querySelector(".btn");
            if (btn) {
              btn.addEventListener("click", trackReserveNow);
            } else {
              console.error("❌ Button not found");
            }
          }
        }, 100);
      });
    </script>
  </body>
</html>
