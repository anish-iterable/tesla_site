<script>
  document.addEventListener("DOMContentLoaded", function () {
    var interval = setInterval(function () {
      if (window.Iterable && typeof Iterable.initialize === "function") {
        clearInterval(interval);

        console.log("✅ Iterable SDK Loaded Successfully");

        // Use your actual API key (ensure it has web permissions)
        const API_KEY = "8c641f7927bc4c8da562f28d04563bc5";

        // Initialize Iterable WITHOUT JWT
        Iterable.initialize(API_KEY, {
          autoPushSubscribe: true, // Enable push notifications
          verbose: true, // Enable logging
        });

        // Identify user
        Iterable.setUserId("Taylan.Somani@gmail.com");
        console.log("✅ User Identified:", Iterable.getUserId());

        // Track "Reserve Now" button click
        function trackReserveNow() {
          Iterable.track("Reserve Now Clicked", {
            model: "Model S",
            page: window.location.pathname,
          }).then(() => {
            console.log("✅ Event tracked successfully");
          }).catch(error => {
            console.error("❌ Error tracking event:", error);
          });
        }

        // Attach event listener
        const btn = document.querySelector(".btn");
        if (btn) {
          btn.addEventListener("click", trackReserveNow);
        } else {
          console.error("❌ Button not found");
        }
      }
    }, 100);
  });
</script>
